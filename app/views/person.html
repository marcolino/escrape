<div class="container">

<!--<pre>person:{{person}}</pre>-->
  <div class="tabbable tabs-below">
    <ul class="nav nav-pills">
      <li ng-class="{active: tabSelected === 'main', hide: tabs['main'].hidden}">
        <a href="" ng-click="tabSelected = 'main'">{{tabs['main'].description}}</a>
      </li>
      <li ng-class="{active: tabSelected === 'photos', hide: tabs['photos'].hidden}">
        <a href="" ng-click="tabSelected = 'photos'">{{tabs['photos'].description}}</a>
      </li>
      <li ng-class="{active: tabSelected === 'photosOccurrences', hide: tabs['photosOccurrences'].hidden}">
        <a href="" ng-click="tabSelected = 'photosOccurrences'">{{tabs['photosOccurrences'].description}}</a>
      </li>
      <li ng-class="{active: tabSelected === 'comments', hide: tabs['comments'].hidden}">
        <a href="" ng-click="tabSelected = 'comments'">{{tabs['comments'].description}} <span class="badge">{{person.comments.length}}</a>
      </li>
    </ul>

    <!-- main pill -->
    <div class="tab-content" ng-show="tabSelected === 'main' && !tabs['main'].hidden">
      <form class="form-horizontal" style="margin-top:5px">
        <div class="form-group">
          <div class="col-xs-12">
            <div class="slider-horizontal">
              <span ng-repeat="(number, photo) in person.photos" class="slider-image">
              <!--<pre>number:{{number}}, photo:{{photo}}</pre>-->
              <a href="" ng-click="tabSelect('photos', number)" class="no-text-decoration">
                <img ng-src="{{cfg.apiUri + '/' + photo.path_small}}" ng-class="{'img-fake': photo.thruthful === 'false'}" class="img-rounded img-clip" />
                <div ng-if="photo.thruthful === 'false'">
                  <img src="images/watermarks/fake-label.png" class="label-image" />
                </div>
                <div ng-if="photo.thruthful === 'true'">
                  <img src="images/watermarks/thruthful-label.png" class="label-image" />
                </div>
                <div ng-if="photo.thruthful === 'unknown'">
                  <img src="images/watermarks/unknown-label.png" class="label-image" />
                </div>
              </a>
              </span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-xs-12">
            <div class="input-group">
              <span class="input-group-addon" title="Name"><span class="glyphicon glyphicon-user"></span></span>
              <input type="text" class="form-control" ng-model="person.name" placeholder="Name">
            </div>
          </div>
<!--
          <div class="col-xs-6">
            <div class="input-group">
              <span class="input-group-addon" title="Real name"><span class="glyphicon glyphicon-heart"></span></span>
              <input type="text" class="form-control" ng-model="person.realname" placeholder="Real name">
            </div>
          </div>
-->
        </div>
        <div class="form-group">
          <div class="col-xs-6">
            <div class="input-group">
              <span class="input-group-addon" title="Description"><span class="glyphicon glyphicon-pencil"></span></span>
              <textarea class="form-control" rows="3" ng-model="person.description" placeholder="Description"></textarea>
            </div>
          </div>
          <div class="col-xs-6">
            <div class="input-group">
              <span class="input-group-addon" title="Notes"><span class="glyphicon glyphicon-edit"></span></span>
              <textarea class="form-control" rows="3" ng-model="person.notes" placeholder="Notes"></textarea>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-xs-7 col-sm-6 col-md-6 col-lg-6">
            <div class="dropdown">
              <div class="input-group" data-toggle="dropdown">
                <span class="input-group-addon" title="Nationality"><i class="f16"><i ng-class="countries.getCountryClass(person.nationality)"></i></i></span>
                <input class="form-control" id="query" name="query" type="text" ng-value="countries.getCountryName(person.nationality)" />
              </div>
              <ul class="dropdown-menu scrollable-menu" role="menu">
                <li ng-repeat="(countryCode, countryName) in countries.countries" class="flag-li">
                  <a ng-click="changeCountry('{{countryCode}}')"><i class="f16"><i ng-class="countries.getCountryClass(countryCode)"></i></i> {{countryName}}</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-xs-5 col-sm-6 col-md-6 col-lg-6">
            <div class="input-group">
<!--
              <span class="input-group-addon" title="Referrals sources"><span class="glyphicon glyphicon-cloud-download"></span></span>
              <div class="form-control">
                <div class="slider-horizontal">
                  <span ng-repeat="(id, value) in sources">
                      <img class="image-referral-source" ng-src="images/referral-sources/{{id}}.png" ng-attr-title="{{value.name}}">
                  </span>
                </div>
              </div>
-->
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-xs-5 col-sm-3 col-md-2 col-lg-2">
            <div class="input-group">
              <span class="input-group-addon" title="Vote up" ng-click="vote(+1)"><a href=""><span class="glyphicon glyphicon-thumbs-up"></span></a></span>
              <input type="text" style="min-width: 2.4em" class="form-control" ng-model="person.vote" placeholder="Vote">
              <span class="input-group-addon" title="Vote down" ng-click="vote(-1)"><a href=""><span class="glyphicon glyphicon-thumbs-down"></span></a></span>
            </div>
          </div>
          <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
            <div class="input-group">
              <span class="input-group-addon" title="Phone"><a ng-href="tel:{{person.phone}}"><span class="glyphicon glyphicon-earphone"></span></a></span>
              <input type="text" class="form-control" ng-model="person.phone" placeholder="Phone">
            </div>
          </div>
          <div class="col-xs-3 col-sm-5 col-md-6 col-lg-6">
            <div class="input-group">
              <span class="input-group-addon" title="Date of last sync"><span class="glyphicon glyphicon-calendar"></span></span>
              <input type="text" class="form-control" ng-value="person.timestamp_last_sync * 1000 | date:'yyyy-MM-dd'" " HH:mm:ss'" readonly placeholder="Last time sync'ed">
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-xs-12">
            <div class="input-group">
              <span class="input-group-addon" title="Street address photo"><a data-toggle="modal" data-target="#streetAddressModalPopup"><span class="glyphicon glyphicon-home"></span></a></span>
              <input type="text" class="form-control" ng-model="person.streetAddress" placeholder="Street address">
              <span class="input-group-addon" title="Street address indications"><a data-toggle="modal" data-target="#streetAddressIndicationsModalPopup"><span class="glyphicon glyphicon-road"></span></a></span>
            </div>
          </div>
        </div>
 
        <div class="form-group" style="vertical-align:bottom">
          <div class="col-xs-4 col-sm-2 col-lg-1">
            <button class="btn btn-primary" title="Save changes to this person's data" ng-click="savePerson(person)"><i class="glyphicon glyphicon-floppy-disk">&nbsp;</i>Save</button>
          </div>
          <span ng-if="person.uniq_prev !== null">
            <div class="col-xs-4 col-sm-2 col-lg-1 pull-right">
              <button class="btn btn-info" title="Previous source for this person" ng-click="open(person.uniq_prev)"><i class="glyphicon glyphicon-step-backward">&nbsp;</i>Previous</button>
            </div>
          </span>
          <span ng-if="person.uniq_next !== null">
            <div class="col-xs-4 col-sm-2 col-lg-1 pull-right">
              <button class="btn btn-info" title="Next source for this person" ng-click="open(person.uniq_next)"><i class="glyphicon glyphicon-step-forward">&nbsp;</i>Next</button>
            </div>
          </span>
        </div>
      </form>

      <!-- street address modal popup -->
      <div id="streetAddressModalPopup" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title">{{person.streetAddress}}</h4>
            </div>
            <div class="modal-body">
              <img ng-src="{{person.streetAddressImageUrl}}" class="img-responsive">
            </div>
          </div>
        </div>
      </div>

      <!-- street address indications modal popup -->
      <div class="modal fade" id="streetAddressIndicationsModalPopup">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title">{{person.streetAddress}}</h4>
            </div>
            <div class="modal-body">
              <map style="display: block; height: 32em; width: 100%;" zoom="14" scrollwheel="false" zoom-control-options="{ style: 'small' }" map-type-id="ROADMAP">
                <marker position="{{person.streetLocation}}" title="{{person.streetAddress}}" draggable="false" visible="true"></marker>
              </map>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- photos pill -->
    <!--<pre> person: {{person}} </pre>-->
    <div class="tab-content" ng-show="tabSelected === 'photos' && !tabs['photos'].hidden">
      <div class="slides-control">
        <carousel disable-animation="true">
          <slide ng-repeat="photo in person.photos" active="photo.active">
            <img class="slide" ng-src="{{cfg.apiUri + '/' + photo.path_full}}" />
            <div class="carousel-caption">
              <p>{{slide.text}}</p>
            </div>
            <div class="carousel-toolbar">
              <div class="form-group" style="vertical-align:bottom">
                <div class="col-xs-12">
                  <button ng-click="getPhotoOccurrences(person.id, '{{photo.url}}')" class="btn btn-success"><i class="glyphicon glyphicon-ok"></i> Check</button>
                </div>
              </div>
            </div>
          </slide>
        </carousel>
      </div>
    </div>

    <!-- photosOccurrences pill -->
    <div class="tab-content" ng-show="tabSelected === 'photosOccurrences' && !tabs['photosOccurrences'].hidden">
      <div class="jumbotron" ng-show="photosOccurrencesLoading">
        <div class="text-center">
          <span><img src="images/loading.gif" /> &emsp; Searching occurrences of this photo in the whole web...</span>
        </div>
      </div>
      <div id="photos-occurrences-best-guess" ng-show="!photosOccurrencesLoading && photosOccurrencesBestGuess">
        Best guess for this photo is: <a ng-href="{{photosOccurrencesBestGuess.href}}" target="_blank"><i>{{photosOccurrencesBestGuess.text}}</i></a>
      </div>
      <div style="overflow-y: auto; overflow-x: hidden;" resize resize-before="photos-occurrences-best-guess" resize-after="150" NOresize-after="photos-occurrences-toolbar">
        <div class="row row-gap" ng-repeat="photosOccurrence in photosOccurrences | filter:whitelist">
          <a ng-href="{{photosOccurrence.href}}" target="_blank" class="no-text-decoration">
            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-1">
              <div class="img-rounded img-clip-small-container">
                <img ng-src="{{photosOccurrence.imgsrc}}" class="img-rounded img-clip-small" />
              </div>
            </div>
          </a>
          <div class="col-xs-4 col-sm-4 col-md-4 col-lg-5">
            <small><i style="color:darkgreen"><span ng-bind-html="photosOccurrence.hrefShort"></span></i></small>
          </div>
          <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
            <small><span ng-bind-html="photosOccurrence.text"></span></small>
          </div>
          <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
            <button class="btn btn-default btn-shorter" ng-click="photosOccurrencesAddToWhitelist(photosOccurrence.href)" title="add this domain to domains white-list (and then ignore it from results)">
              <i class="glyphicon glyphicon-smaller glyphicon-minus"></i>
            </button>
          </div>
        </div>
      </div>
      <div ng-show="!photosOccurrencesLoading && photosOccurrences.length === 0">
        <div class="text-center">
          <h4>No other occurrences of this photo found in the whole web: it is presumably thruthful.</h4>
        </div>
      </div>

      <div id="photos-occurrences-toolbar" Xng-hide="photosOccurrencesLoading">
        <hr>
        <button ng-click="photosOccurrencesThruthful()" class="btn btn-success"><i class="glyphicon glyphicon-ok"></i> Truthful</button>
        <button ng-click="photosOccurrencesFake()" class="btn btn-danger"><i class="glyphicon glyphicon-ban-circle"></i> Fake</button>
        <button ng-click="photosOccurrencesUndecided()" class="btn btn-warning"><i class="glyphicon glyphicon-question-sign"></i> Don't know</button>
        <!--<button NOng-hide="photosOccurrences === null" ng-click="photosOccurrencesFake()" class="btn btn-danger"><i class="glyphicon glyphicon-ban-circle"></i> Fake</button>-->
      </div>
    </div>

    <!-- comments pill -->
    <div class="tab-content" ng-show="tabSelected === 'comments' && !tabs['comments'].hidden">
      <div class="row" ng-if="person.comments.length === 0">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 persons-warning-text">
          <span>Sorry, no comments found about {{person.name}} (phone: {{person.phone}})</span>
        </div>
      </div>

<!--<pre>&emsp; persons:{{persons}}</pre>-->
<pre>&emsp; person.comments:{{person.comments}}</pre>
<pre>&emsp; personsPerComment:{{personsPerComment}}</pre>
<hr>
      <div class="comments">
        <div ng-repeat="(n, comment) in person.comments | orderBy: ['topic', 'date']" class="row row-gap">
<!--<pre>&emsp; comment #: {{n}}, comment: {{comment}}</pre>-->
          <div class="form-group">
            <div class="col-xs-12">
              <div class="input-group">
                <div class="input-group-addon" style="vertical-align: top; min-width:250px; font-size: 12px;" title="Comment">
                  <div class="row" style="text-align: left; margin-bottom: 3px;">
                    <div class="col-xs-4" style="padding-right: 0;">
                      <div class="pull-right"><i>N&deg;:</i></div>
                    </div>
                    <div class="col-xs-8" style="padding-left: 5px;">
                      <div>{{1+$index}}</div>
                    </div>
                  </div>
                  <div class="row" style="text-align: left; margin-bottom: 3px;">
                    <div class="col-xs-4" style="padding-right: 0;">
                      <div class="pull-right"><i>Topic:</i></div>
                    </div>
                    <div class="col-xs-8" style="padding-left: 5px;">
                      <div>{{comment.topic}}</div>
                    </div>
                  </div>
                  <div class="row" style="text-align: left; margin-bottom: 3px;">
                    <div class="col-xs-4" style="padding-right: 0;">
                      <div class="pull-right"><i>Date:</i></div>
                    </div>
                    <div class="col-xs-8" style="padding-left: 5px;">
                      <div>{{comment.timestamp | date:'yyyy-MM-dd HH:mm:ss'}}</div>
                    </div>
                  </div>
                  <div class="row" style="text-align: left; margin-bottom: 3px;">
                    <div class="col-xs-4" style="padding-right: 0;">
                      <div class="pull-right"><i>Author:</i></div>
                    </div>
                    <div class="col-xs-8" style="padding-left: 5px;">
                      <div>{{comment.author_nick}}</div>
                    </div>
                  </div>
                  <div class="row" style="text-align: left; margin-bottom: 3px;">
                    <div class="col-xs-4" style="padding-right: 0;">
                      <div class="pull-right"><i>Author karma:</i></div>
                    </div>
                    <div class="col-xs-8" style="padding-left: 5px;">
                      <div>{{comment.author_karma}}</div>
                    </div>
                  </div>
                  <div class="row" style="text-align: left; margin-bottom: 3px;">
                    <div class="col-xs-4" style="padding-right: 0;">
                      <div class="pull-right"><i>Author posts:</i></div>
                    </div>
                    <div class="col-xs-8" style="padding-left: 5px;">
                      <div>{{comment.author_posts}}</div>
                    </div>
                  </div>

                  <div class="row" style="text-align: left; margin-bottom: 3px;">
                    <div class="col-xs-12">
                      <div class="dropdown">
                        <div class="input-group" data-toggle="dropdown">
                          <!-- TODO: isAnyPersonInCommentActive() should be called dynamically (currently it doesn't refresh when flipPersonInCommentActive() is called...) -->
                          <span class="input-group-addon" ng-attr-title="{{isAnyPersonInCommentActive(comment.id) ? 'This comment is confirmed to be referring to this person' : 'This comment is not confirmed to be referring to this person:\nselect the right person, please'}}"><i class="glyphicon glyphicon-user" ng-class="{'text-success': isAnyPersonInCommentActive(comment.id)}"></i></span>
                      <!--<input class="form-control" type="text" ng-value="persons.getPersonName(comment.id_person)" />-->
<!--<pre>{{personsPerComment}}</pre>-->
                          <input class="form-control" type="text" ng-value="getPersonInCommentActive().name" />
                        </div>
                        <ul class="dropdown-menu scrollable-menu" role="menu">
                          <li ng-repeat="p in personsPerComment">
                            <a ng-click="flipPersonInCommentActive(comment.id, p.id)"><i class="glyphicon" ng-class="{'glyphicon-ok text-success': p.active, 'glyphicon-none': !p.active}">&nbsp;</i>{{p.name}}</a>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="row" style="text-align: left; margin-bottom: 3px;">
                    <div class="col-xs-12">
                      <div class="input-group">
                        <span class="input-group-addon btn btn-success" ng-click="rating(comment.id, 1)" title="increase positivity rating of this comment"><i class="glyphicon glyphicon-thumbs-up"></i></span>
                        <input type="text" style="min-width: 2.4em" class="form-control" ng-model="comment.content_rating" placeholder="Rating">
                        <span class="input-group-addon btn btn-danger" ng-click="rating(comment.id, -1)" title="decrease positivity rating of this comment"><i class="glyphicon glyphicon-thumbs-down"></i></span>
                      </div>
                    </div>
                  </div>
                </div>
                <!--<div class="form-control" style="min-height: 180px; overflow-y:auto;" ng-bind-html="comment.content"></div>-->
                <textarea class="form-control" NOrows="3" ng-model="comment.content" style="min-height: 180px; overflow-y:auto;">
                </textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>